#!/usr/bin/env node

const runWhen = require('../dist/index.js');
const {promisify} = require('util');
const exec = promisify(require('child_process').exec);
const {2: serializedGlob, 3: command} = process.argv;
let glob;

(async () => {
  try {
    const glob = JSON.parse(serializedGlob);

    await runWhen([{
      glob,
      task: async () => {
        try {
          const {stdout} = await exec(command);
          console.log(stdout);
        } catch (e) {
          console.log(e);
          process.exit(1);
        }
      }
    }]);
  } catch (e) {
    console.log(e.message);
    process.exit(1);
  }
})();
